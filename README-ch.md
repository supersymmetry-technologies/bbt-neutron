<div align="center">
  <img src="./figures/ssymmetry-logo.png?raw=true" width="60%" alt="Ssymmetry" />
</div>
<hr>
<div align="center" style="line-height: 1;">
  <a href="https://www.ssymmetry.com/" target="_blank" style="margin: 2px;">
    <img alt="Homepage" src="./figures/super_symmetry-group-blue.svg?raw=true" style="display: inline-block; vertical-align: middle;"/>
  </a>
  <a href="https://www.ssymmetry.com" target="_blank" style="margin: 2px;">
    <img alt="Hugging Face" src="./figures/big_bang_transformer-neutron-blue.svg?raw=true" style="display: inline-block; vertical-align: middle;"/>
  </a>
</div>


<div align="center" style="line-height: 1;">
  <a href="https://github.com/supersymmetry-technologies/bbt-neutron/blob/main/LICENSE" style="margin: 2px;">
    <img alt="Code License" src="https://img.shields.io/badge/Code_License-MIT-f5de53?&color=f5de53" style="display: inline-block; vertical-align: middle;"/>
  </a>
  <a href="https://github.com/supersymmetry-technologies/bbt-neutron/blob/main/LICENSE-MODEL" style="margin: 2px;">
    <img alt="Model License" src="https://img.shields.io/badge/Model_License-Model_Agreement-f5de53?&color=f5de53" style="display: inline-block; vertical-align: middle;"/>
  </a>
</div>

<div align="center" style="line-height: 1;">
  <a href="#2-model-architecture">æ¨¡å‹æ¶æ„</a> |
  <a href="#3-data-processing">æ•°æ®å¤„ç†</a> |
  <a href="#5-environment">ç³»ç»Ÿç¯å¢ƒ</a> |
  <a href="#6-training-inference-and-evaluation">è®­ç»ƒ,æ¨ç†å’Œè¯„æµ‹</a> |
  <a href="#7-quick-start">å¿«é€Ÿå¼€å§‹</a>
</div>

<div align="center" style="line-height: 1;">
  <a href="https://arxiv.org/pdf/2412.00129"><b>è®ºæ–‡é“¾æ¥</b>ğŸ‘ï¸</a>
</div>

# BBT-Neutron: ä¸€ä¸ªä¸“ä¸ºç§‘å­¦é¢†åŸŸè®¾è®¡çš„å¤šä»»åŠ¡å¤§è¯­è¨€æ¨¡å‹

## 1. ç®€ä»‹

å‡ åå¹´æ¥ï¼Œç ”ç©¶äººå‘˜å¼€å‘äº†ç‰¹å®šä»»åŠ¡çš„æ¨¡å‹ï¼Œä»¥è§£å†³è·¨ä¸åŒå­¦ç§‘çš„ç§‘å­¦æŒ‘æˆ˜ã€‚æœ€è¿‘ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åœ¨å¤„ç†é€šç”¨ä»»åŠ¡æ–¹é¢è¡¨ç°å‡ºäº†å·¨å¤§çš„èƒ½åŠ›ï¼›ç„¶è€Œï¼Œè¿™äº›æ¨¡å‹åœ¨è§£å†³ç°å®ä¸–ç•Œä¸­çš„ç§‘å­¦é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠå¤§è§„æ¨¡æ•°å€¼æ•°æ®åˆ†æçš„é¢†åŸŸï¼ˆå¦‚å®éªŒé«˜èƒ½ç‰©ç†ï¼‰æ—¶é‡åˆ°äº†å›°éš¾ã€‚è¿™ä¸€å±€é™æ€§ä¸»è¦æ˜¯ç”±äºBPEæ ‡è®°åŒ–æ–¹æ³•åœ¨å¤„ç†æ•°å€¼æ•°æ®æ—¶æ•ˆæœä¸ä½³ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ä¸ä»»åŠ¡æ— å…³çš„æ¶æ„BBT-Neutronï¼Œè¯¥æ¶æ„é‡‡ç”¨äºŒè¿›åˆ¶æ ‡è®°åŒ–æ–¹æ³•æ¥ä¿ƒè¿›å¯¹æ–‡æœ¬å’Œå¤§è§„æ¨¡æ•°å€¼å®éªŒæ•°æ®çš„æ··åˆè¿›è¡Œé¢„è®­ç»ƒã€‚æˆ‘ä»¬å±•ç¤ºäº†BBT-Neutronåœ¨å–·æ³¨èµ·æºè¯†åˆ«ï¼ˆJet Origin Identificationï¼ŒJoIï¼‰ä¸­çš„åº”ç”¨ï¼Œè¿™æ˜¯é«˜èƒ½ç‰©ç†ä¸­çš„ä¸€ä¸ªå…³é”®åˆ†ç±»æŒ‘æˆ˜ï¼Œç”¨äºåŒºåˆ†æ¥è‡ªä¸åŒå¤¸å…‹æˆ–èƒ¶å­çš„å–·æ³¨ã€‚æˆ‘ä»¬çš„ç»“æœè¡¨æ˜ï¼ŒBBT-Neutronçš„æ€§èƒ½ä¸æœ€å…ˆè¿›çš„ç‰¹å®šä»»åŠ¡JoIæ¨¡å‹ç›¸å½“ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ç ”ç©¶äº†BBT-Neutronæ€§èƒ½éšæ•°æ®é‡å¢åŠ çš„æ‰©å±•è¡Œä¸ºï¼Œè¿™è¡¨æ˜BBT-Neutronæœ‰æ½œåŠ›æˆä¸ºç²’å­ç‰©ç†æ•°æ®åˆ†æçš„åŸºç¡€æ¨¡å‹ï¼Œå¹¶å¯èƒ½æ‰©å±•åˆ°å¤§å‹ç§‘å­¦å®éªŒã€å·¥ä¸šåˆ¶é€ å’Œç©ºé—´è®¡ç®—ç­‰å¹¿æ³›é¢†åŸŸçš„ç§‘å­¦è®¡ç®—åº”ç”¨ã€‚

## 2. æ¨¡å‹æ¶æ„

<div align="center" style="display: flex; justify-content: center;">
    <img src="./figures/BBT_model_arch.png?raw=true" style="height:600px; width:auto; margin-right:10px">
</div>

## 3. æ•°æ®å¤„ç†

åˆ†ä¸¤ç§æ–¹æ¡ˆï¼š
- æµå¼å¯åŠ¨è®­ç»ƒ
- ç›´æ¥éæµå¼å¯åŠ¨è®­ç»ƒ
- é¢„å¤„ç†åï¼Œéæµå¼å¯åŠ¨è®­ç»ƒ

### æµå¼å¯åŠ¨è®­ç»ƒ

å¦‚æœæ²¡åšæ•°æ®é¢„å¤„ç†ï¼Œåˆ™åœ¨è®­ç»ƒä»£ç ä¸­ï¼Œä½¿ç”¨ä¸‹åˆ—ä»£ç ï¼Œè®­ç»ƒæ—¶é¢„å¤„ç†ã€‚åˆ†ä¸ºè®­ç»ƒæ—¶æµå¼å¤„ç†å¯åŠ¨è®­ç»ƒå’Œè®­ç»ƒæ—¶éæµå¼å¤„ç†å¯åŠ¨è®­ç»ƒã€‚
```py
    # Load datasets
    logger.info("start load datasets")
    with training_args.main_process_first(desc="dataset map"):
        datasets = load_and_prepare_datasets(task_type=data_args.task_type,
                                             train_dir=data_args.train_dir,
                                             validation_dir=data_args.validation_dir,
                                             test_dir=None,
                                             block_size=data_args.block_size,
                                             patch_size=data_args.patch_size,
                                             step_size=data_args.step_size,
                                             pad_id=0,
                                             streaming=data_args.streaming,
                                             cache_dir=None,
                                             num_proc=data_args.preprocessing_num_workers)
        # datasets = get_arrow_dataset(data_args.data_dir)
    logger.info("end load datasets")
```

åœ¨è®­ç»ƒä¸»è¦åŠ è½½æ•°æ®ä»£ç ä¸­ï¼Œ`--streaming true`ã€‚æŒ‡å®šæ•°æ®ç›®å½•`--train_dir`å’Œ`--validation_dir`ã€‚
è¯¥çŠ¶æ€ï¼Œä»£ç ä¼šä½¿ç”¨`data_utils.py`çš„`load_and_prepare_dataset`ï¼Œå®æ—¶ä½¿ç”¨æ•°æ®å¤„ç†çš„æ–¹å¼è¿›è¡Œè®­ç»ƒã€‚
æ­¤æ—¶æ•°æ®æ¯æ¬¡åŠ è½½ä¸€æ¡å¤„ç†ä¸€æ¡ï¼Œåœ¨å¤šæœºç»§ç»­è®­ç»ƒæ—¶`--ignore_data_skip true`ï¼Œå¦åˆ™ä¼šå¯¼è‡´éœ€è¦å¤§é‡æ—¶é—´å¤„ç†å·²ç»è®­ç»ƒè¿‡çš„æ•°æ®

### ç›´æ¥éæµå¼å¯åŠ¨è®­ç»ƒ

`--streaming false` dataset mapå‡½æ•°å°†æ•°æ®å¤„ç†ç¼“å­˜åˆ°cacheä¸‹ã€‚æ³¨æ„å¤„ç†æ—¶é—´ï¼Œç¼“å­˜ç©ºé—´ç­‰é—®é¢˜

### é¢„å¤„ç†åï¼Œéæµå¼å¯åŠ¨è®­ç»ƒ

æ¯”è¾ƒæ¨èå…ˆåšæ•°æ®é¢„å¤„ç†ï¼Œåè®­ç»ƒä»£ç ä¸­ä½¿ç”¨ä¸‹åˆ—ä»£ç ï¼ŒåŠ è½½é¢„å¤„ç†çš„æ•°æ®è¿›è¡Œä½¿ç”¨ã€‚
```py
    # Load datasets
    logger.info("start load datasets")
    with training_args.main_process_first(desc="dataset map"):
        # datasets = load_and_prepare_datasets(task_type=data_args.task_type,
        #                                      train_dir=data_args.train_dir,
        #                                      validation_dir=data_args.validation_dir,
        #                                      test_dir=None,
        #                                      block_size=data_args.block_size,
        #                                      patch_size=data_args.patch_size,
        #                                      step_size=data_args.step_size,
        #                                      pad_id=0,
        #                                      streaming=data_args.streaming,
        #                                      cache_dir=None,
        #                                      num_proc=data_args.preprocessing_num_workers)
        datasets = get_arrow_dataset(data_args.data_dir)
    logger.info("end load datasets")
```
æ­¤æ—¶éœ€è¦æŒ‡å®š`--streaming true`ï¼ŒæŒ‡å®šæ•°æ®ç›®å½•`--data_dir`

### æ•°æ®é¢„å¤„ç†

å‚è€ƒè§`data_utils.py`çš„```if __name__=="__main__"```:æ–¹æ³•ï¼Œé¢„å…ˆå¤„ç†æ•°æ®ï¼Œä½¿ç”¨`preprocess_dataset`ã€‚

è¯¥éƒ¨åˆ†æ˜¯å­—èŠ‚å‹é¢„å¤„ç†ï¼Œä½¿ç”¨æ–¹æ³•è¯¦è§`data_utils.py`ä»£ç ä»¥åŠ`BBT-Neutron-SimpleGuide.md`ç›¸å…³ä½¿ç”¨è¯´æ˜ã€‚

å…¶ä¸­æ•°æ®é¢„å¤„ç†éœ€è¦æ³¨æ„ï¼Œæ˜¯ä½¿ç”¨padæ¨¡å¼è¿˜æ˜¯æ‹¼æ¥æ¨¡å¼ã€‚å³éœ€è¦å°†æ‰€æœ‰æ•°æ®æ‹¼æ¥æˆä¸€ä¸ªé•¿å­—ç¬¦ä¸²ï¼Œç„¶åå†æŒ‰ç…§æ¨¡å‹é•¿åº¦åšchunkï¼Œå†èˆå¼ƒæœ€åé‚£ä¸ªä¸è¶³æ¨¡å‹é•¿åº¦çš„éƒ¨åˆ†ã€‚

æˆ–è€…å…¨éƒ¨ç›´æ¥åšchunkï¼Œä¸è¶³çš„padåˆ°æ¨¡å‹é•¿åº¦ã€‚ä¸€èˆ¬æœ¬ä»£ç é¢„è®­ç»ƒä¸­ç”¨å‰è€…ï¼Œèˆå¼ƒpadåŠ å¿«é€Ÿåº¦ï¼Œå¾®è°ƒæ—¶å†ç”¨å•ä¸ªdocåšpadå…é™¤å¤šä¸ªdocä¹‹é—´å¹²æ‰°ã€‚

å‰è€…çš„æƒ…å†µå»ºè®®åœ¨è¯­æ–™`bos`ï¼Œ`eos`æ·»åŠ ç‰¹æ®Štokenã€‚

## 4. æ¨¡å‹

åŒ…å«v1å’Œv2ç‰ˆæœ¬éœ€è¦æ ¹æ®éœ€æ±‚åˆ‡æ¢ï¼Œv1ç‰ˆæœ¬å¸¦patchæ€»ä½“è®¡ç®—é€Ÿåº¦æ›´å¿«ï¼Œv2æ˜¯çº¯å­—èŠ‚æ¨¡å‹ã€‚ç”±äºpatchå­˜åœ¨ï¼Œv2æ¨¡å‹å…¼å®¹hfæ¨¡å‹åŠŸèƒ½ã€‚

ä½¿ç”¨æ—¶ä¿®æ”¹```model/__init__.py```ï¼ŒæŒ‡å®šå¯¹å¯¹åº”çš„æ¨¡å‹ä»£ç åŠ è½½ã€‚

é…å¥—çš„`pretrain.py`ä¹Ÿéœ€è¦å°†å¯¹åº”`BinBBTConfig`çš„`config.auto_map`å¡«å†™è¿™æ­£ç¡®ï¼ˆç”¨äºä¿å­˜çš„æƒé‡é¡ºåˆ©åŠ è½½ï¼‰ã€‚

å­—èŠ‚æ¨¡å‹çš„tokenizerå®Œå…¨ä¸åŒï¼Œæœ¬é¡¹ç›®å¼€å‘äº†å­—èŠ‚tokenizerï¼Œ`tokenization_binbbt.py`æœ‰å¾…æ›´å®Œå–„çš„åŠŸèƒ½æµ‹è¯•ã€‚

## 5. ç¯å¢ƒ

åœ¨dockeræ–‡ä»¶å¤¹ä¸‹æœ‰å‡ ä¹æ‰€æœ‰çš„ä¾èµ–è¦æ±‚ï¼Œè¯·åŠ¡å¿…å¯¹åº”æ‰€æœ‰çš„ä¾èµ–åº“ï¼Œä»Šååšå¥½ç¯å¢ƒç®¡ç†å’Œç¯å¢ƒå‡çº§ã€‚æœ¬é¡¹ç›®ä¸»è¦å…¼å®¹hfæ¨¡å‹å’Œç›¸å…³æ¥å£ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ä¸ºhfæ¨¡å‹éœ€è¦çš„ä»¥æ¥ç»„ä»¶ã€‚

configæ–‡ä»¶å¤¹ä¸‹æœ‰è®­ç»ƒéœ€è¦çš„ç¯å¢ƒå‚æ•°ï¼Œå¯¹åº”dockerfileã€‚

## 6. è®­ç»ƒï¼Œæ¨ç†ï¼Œæµ‹è¯„

ä½¿ç”¨`pretrain.sh`è®­ç»ƒï¼Œ`generate.sh`å¯¹è¯ï¼Œ`inference.sh`æ¨ç†ï¼Œ`eval_clm.sh`æµ‹è¯„ã€‚

è®­ç»ƒï¼Œå¯¹è¯ï¼Œæ¨ç†ä»£ç æœ‰å¾ˆå¤§ç›¸ä¼¼åº¦ï¼Œå¦‚æœä¿®æ”¹è¯·å…¨å±€è€ƒè™‘ã€‚éƒ½ä½¿ç”¨äº†hf modelï¼Œhf trainerç­‰é€šç”¨æ–¹æ¡ˆã€‚

æ¨ç†å¯ä»¥ä¸ä½¿ç”¨deepspeedï¼Œå³åˆ é™¤`--deepspeed`ã€‚å¦‚æœä½¿ç”¨deepspeed inferenceæ¨ç†åˆ™å¿…é¡»è¦ç”¨zero3åšæ¨¡å‹å¹¶è¡Œã€‚è¯¥åŠŸèƒ½ç°åœ¨ç‰ˆæœ¬å·²ç»æ­£å¸¸ã€‚

## 7. å¿«é€Ÿå¼€å§‹

å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨æˆ‘ä»¬çš„é¡¹ç›®æ¥æ‰§è¡Œä¸€ä¸ªç²’å­ç‰©ç†jetæ ‡æ³¨ä»»åŠ¡ï¼Œè¯·å‚ç…§ä¸‹é¢çš„æ­¥éª¤ï¼š

1. æ•°æ®é›†

    åœ¨ç²’å­ç‰©ç†jetæ ‡æ³¨ä»»åŠ¡ä¸­ï¼Œä¸€ä¸ªå…¸å‹çš„æ•°æ®æ ·æœ¬çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š
```jsonl
{"data": "0: -1, 7.982902, (-7.899555, 0.408736, -1.066399), 2.077302, 2.068143, -0.098329, -0.213443, -2.259137, -2.381407, 0.235003, 0.024568, 0.048371, -0.042774, 0.049214, charged pion. 1: -1, 6.685446, (-6.462185, -0.339102, -1.605216), 1.899933, 1.867342, 0.012845, -0.109320, -2.459938, -2.558776, 0.110073, -0.075995, 0.049435, 0.110177, 0.050115, charged kaon. 2: 1, 4.962568, (-4.854748, 0.267230, -0.983670), 1.601923, 1.581470, -0.031780, -0.216737, -2.745810, -2.856786, 0.219054, 0.057629, 0.051062, 0.051798, 0.051452, charged pion. 3: 0, 4.401175, (-4.365309, -0.099968, -0.551752), 1.481872, 1.473951, -0.106711, -0.138851, -2.853329, -2.976837, 0.175119, 0.000000, 0.000000, 0.000000, 0.000000, photon. 4: 0, 4.395812, (-4.382381, 0.044969, -0.340397), 1.480652, 1.477645, -0.155146, -0.172008, -2.849635, -2.978057, 0.231640, 0.000000, 0.000000, 0.000000, 0.000000, photon. 5: -1, 4.005426, (-3.877740, -0.056291, -0.991927), 1.387650, 1.355358, 0.020325, -0.147232, -2.971922, -3.071059, 0.148628, -0.048030, 0.052246, 0.063851, 0.052600, charged pion. 6: 1, 3.805775, (-3.662414, 0.301091, -0.980059), 1.336520, 1.301490, 0.030896, -0.243774, -3.025790, -3.122189, 0.245724, 0.053499, 0.052695, 0.053155, 0.053051, charged pion. 7: 0, 3.426863, (-3.365381, 0.404382, -0.504060), 1.231645, 1.220709, -0.084573, -0.281333, -3.106572, -3.227064, 0.293770, 0.000000, 0.000000, 0.000000, 0.000000, photon. 8: 0, 3.352921, (-3.278398, 0.056086, -0.700743), 1.209832, 1.187501, -0.020619, -0.178853, -3.139779, -3.248877, 0.180038, 0.000000, 0.000000, 0.000000, 0.000000, photon. 9: 1, 2.926103, (-2.616569, 0.069915, -0.911266), 1.073671, 0.962221, 0.108730, -0.188461, -3.365059, -3.385038, 0.217577, -0.270038, 0.055539, 0.192414, 0.056045, proton. 10: 0, 2.664285, (-1.337302, -2.149693, -0.829975), 0.979936, 0.928895, 0.089488, 0.852545, -3.398385, -3.478773, 0.857229, 0.000000, 0.000000, 0.000000, 0.000000, photon. 11: 0, 2.310138, (-2.300164, -0.031352, -0.212132), 0.837307, 0.833073, -0.140652, -0.148118, -3.494207, -3.621402, 0.204259, 0.000000, 0.000000, 0.000000, 0.000000, photon. 12: 1, 2.307637, (-0.129767, -0.752603, -2.173122), 0.836224, -0.269569, 1.535680, 1.238304, -4.596849, -3.622485, 1.972742, -0.174068, 0.070675, 0.164366, 0.073021, charged pion. 13: 0, 2.294021, (-2.285264, 0.029542, -0.198057), 0.830306, 0.826565, -0.146187, -0.174674, -3.500715, -3.628403, 0.227775, 0.000000, 0.000000, 0.000000, 0.000000, photon. 14: 0, 2.176314, (-2.152707, 0.127555, -0.293127), 0.777632, 0.768479, -0.097225, -0.220931, -3.558802, -3.681077, 0.241378, 0.000000, 0.000000, 0.000000, 0.000000, photon. 15: -1, 2.159010, (-0.841519, 0.001196, -1.752945), 0.769650, -0.172546, 1.247442, -0.163168, -4.499826, -3.689059, 1.258068, 0.318025, 0.069354, -0.397044, 0.071495, proton. 16: 0, 1.953062, (-1.899484, -0.078596, -0.447475), 0.669398, 0.642438, 0.000516, -0.120393, -3.684843, -3.789311, 0.120394, 0.000000, 0.000000, 0.000000, 0.000000, photon. 17: 0, 1.936481, (-1.843615, -0.351870, -0.476689), 0.660873, 0.629618, 0.018585, 0.026844, -3.697662, -3.797836, 0.032649, 0.000000, 0.000000, 0.000000, 0.000000, neutral hadron. 18: 1, 1.909002, (-0.793892, -1.595945, -0.668957), 0.646581, 0.578017, 0.134259, 0.947449, -3.749264, -3.812129, 0.956914, -0.108346, 0.060004, 0.114991, 0.060692, charged pion. 19: 0, 1.802877, (-0.916724, -1.530938, -0.257320), 0.589384, 0.579093, -0.089030, 0.869513, -3.748187, -3.869325, 0.874059, 0.000000, 0.000000, 0.000000, 0.000000, neutral hadron. 20: 1, 1.799525, (-0.458576, -0.713431, -1.580992), 0.587523, -0.164756, 1.148441, 0.837769, -4.492036, -3.871186, 1.421539, 0.245924, 0.069312, 0.223021, 0.071569, charged pion. 21: 1, 1.784490, (-1.749027, -0.175007, -0.274235), 0.579133, 0.564040, -0.077351, -0.062020, -3.763240, -3.879576, 0.099144, -0.060723, 0.059966, 0.058150, 0.060117, charged pion. 22: 1, 1.715898, (-1.641326, -0.320969, -0.357565), 0.539937, 0.514269, -0.020533, 0.031370, -3.813011, -3.918772, 0.037493, -0.133285, 0.060781, 0.095457, 0.061044, charged pion. 23: 0, 1.570416, (-1.480101, 0.401845, -0.337678), 0.451340, 0.427671, -0.014305, -0.426855, -3.899609, -4.007369, 0.427095, 0.000000, 0.000000, 0.000000, 0.000000, neutral hadron. 24: -1, 1.486897, (-0.457783, -0.698566, -1.222220), 0.396691, -0.180084, 0.941541, 0.828944, -4.507364, -4.062018, 1.254451, 0.128159, 0.070086, 0.310163, 0.073498, charged pion. 25: -1, 1.414431, (-0.309921, -0.555473, 1.255601), 0.346727, -0.452426, -1.664667, 0.900130, -4.779706, -4.111982, 1.892445, 0.029776, 0.072301, -0.188226, 0.072500, charged pion. 26: -1, 1.371773, (-0.769531, 0.073952, -1.124560), 0.316104, -0.257378, 0.936606, -0.257552, -4.584658, -4.142605, 0.971373, 0.053427, 0.069742, 0.056873, 0.070574, charged pion. 27: 0, 1.360614, (-1.321092, 0.075450, -0.316692), 0.307936, 0.280087, 0.004363, -0.218797, -4.047194, -4.150773, 0.218841, 0.000000, 0.000000, 0.000000, 0.000000, neutral hadron. 28: -1, 1.226438, (-0.412902, -0.973076, -0.378344), 0.204114, 0.055487, 0.117952, 1.007749, -4.271793, -4.254595, 1.014628, -0.129970, 0.065141, -0.091094, 0.065708, charged kaon. 29: -1, 1.190959, (-0.008252, -0.377224, -1.120954), 0.174759, -0.974676, 1.576457, 1.387178, -5.301956, -4.283950, 2.099876, -0.301847, 0.085622, -0.273366, 0.086198, charged pion. 30: 1, 1.094247, (-0.386346, -0.986615, -0.234999), 0.090066, 0.057856, -0.012729, 1.035816, -4.269424, -4.368642, 1.035894, -0.138490, 0.064938, -0.138975, 0.065153, charged pion. 31: 0, 1.054287, (-1.052853, 0.016745, -0.052341), 0.052864, 0.051630, -0.183052, -0.177651, -4.275650, -4.405845, 0.255084, 0.000000, 0.000000, 0.000000, 0.000000, photon. 32: 0, 0.992163, (-0.458974, -0.850251, -0.225393), -0.007868, -0.034362, -0.001531, 0.914063, -4.361642, -4.466577, 0.914065, 0.000000, 0.000000, 0.000000, 0.000000, photon. 33: 0, 0.913373, (-0.502837, -0.727852, -0.227237), -0.090611, -0.122558, 0.021383, 0.804490, -4.449838, -4.549320, 0.804774, 0.000000, 0.000000, 0.000000, 0.000000, photon. 34: 0, 0.814941, (-0.802700, 0.030826, -0.137299), -0.204640, -0.219038, -0.062639, -0.200132, -4.546318, -4.663349, 0.209705, 0.000000, 0.000000, 0.000000, 0.000000, photon. 35: 0, 0.786306, (-0.767984, -0.024626, -0.166947), -0.240409, -0.263472, -0.017141, -0.129692, -4.590753, -4.699118, 0.130820, 0.000000, 0.000000, 0.000000, 0.000000, photon. 36: 0, 0.767866, (-0.419870, -0.599481, -0.232270), -0.264140, -0.312120, 0.079518, 0.798062, -4.639400, -4.722849, 0.802013, 0.000000, 0.000000, 0.000000, 0.000000, photon. 37: 0, 0.646095, (-0.635767, 0.062700, -0.096475), -0.436809, -0.448084, -0.082293, -0.260050, -4.775364, -4.895518, 0.272760, 0.000000, 0.000000, 0.000000, 0.000000, photon. 38: 0, 0.500555, (-0.025322, -0.282856, -0.412197), -0.692038, -1.258826, 0.934797, 1.319764, -5.586107, -5.150747, 1.617289, 0.000000, 0.000000, 0.000000, 0.000000, neutral hadron.", "label": 0}
```

æ ·æœ¬æ˜¯jsonæ ¼å¼ä¿å­˜çš„ï¼Œå…¶ä¸­å…³é”®å­—'data'ä¸­åŒ…å«äº†å…³äºå½“å‰jetçš„æ‰€æœ‰ä¿¡æ¯ï¼Œå…³é”®å­—'label'è¡¨ç¤ºäº†è¿™ä¸ªjetçš„ç§ç±»ã€‚æ•°æ®0,1,2,3åŠ ä¸Šå†’å·ï¼Œè¡¨ç¤ºå½“å‰jetè¡°å˜çš„æœ«æ€ç²’å­çš„ç¼–å·ã€‚å†’å·ä¹‹åçš„ä¿¡æ¯åŒ…å«äº†æœ«æ€ç²’å­çš„å„ç§å±æ€§ï¼Œä¾‹å¦‚ç²’å­åŠ¨é‡ï¼Œèƒ½é‡ç­‰ã€‚åœ¨è¯¥ä»»åŠ¡ä¸­ä½¿ç”¨çš„å„ä¸ªç‰©ç†å­¦å˜é‡ä»¥åŠç›¸å…³çš„å®šä¹‰åˆ—åœ¨ä¸‹è¡¨ä¸­ï¼š

<div align="center">
  <img src="./figures/input_var_list.png?raw=true" width="60%" alt="List of Variables" />
</div>

2. æ•°æ®é¢„å¤„ç†

```bash
cd example
python preprocess_data.py
```

å‚æ•°é…ç½®

```python
    # Configuration parameters
    task_type = "classification"
    train_dir = "./data/train"  # Replace with your training data directory
    train_save = "./data/processed/train"  # Replace with your processed training data save directory
    validation_dir = "./data/validation"  # Replace with your validation data directory
    validation_save = "./data/processed/validation"  # Replace with your processed validation data save directory
    test_dir = "./data/test"  # Replace with your test data directory
    test_save = "./data/processed/test"  # Replace with your processed test data save directory
    block_size = 2048
    patch_size = 1
    step_size = 2048 * 1
    streaming = False
    cache_dir = "./data/cache"  # Replace with your cache directory
    num_proc = 4  # Adjust based on your machine configuration
    max_shard_size = "4GB"
```

3. è®­ç»ƒ

```bash
cd example
bash run_jet_tagging_train.sh
```

å…³é”®å‚æ•°é…ç½®

```bash
    --task_type classifacation \
    --train_dir ./data/processed/train \
    --validation_dir ./data/processed/validation \
    --cache_dir ./data/cache \
    --streaming false \
    --per_device_train_batch_size 8 \
    --per_device_eval_batch_size 8 \
    --do_train \
    --do_eval \
    --output_dir "${output_model}" \
```

## 8. å…¶ä»–å‚æ•°è®¾ç½®æ–¹æ³•

è§ä½¿ç”¨è€…è´¾å…´éš†åˆ¶ä½œçš„ `BBT-Neutron-SimpleGuide.md`

peftåŠŸèƒ½å’Œv1æ¨¡å‹çš„generateåŠŸèƒ½ï¼Œå°šæœªå®Œå–„ã€‚

### å¯åŠ¨å‘½ä»¤

å¯åŠ¨è®­ç»ƒã€‚å‚æ•°è¯¦è§`BBT-Neutron-SimpleGuide.md`å’Œ[hf trainerå®˜æ–¹å‚è€ƒ](https://huggingface.co/docs/transformers/main_classes/trainer)ã€‚ä¿®æ”¹`model/__init__.py`é€‰æ‹©æ­£ç¡®æ¨¡å‹ï¼Œè®¾ç½®å¥½`configuration_binbbt`çš„æ¨¡å‹å‚æ•°ã€‚
```bash
cd train/pretrain
bash pretrain.sh
```

å¯åŠ¨æµ‹è¯„ã€‚ä¿®æ”¹`--config_file`é…ç½®å‚æ•°ï¼Œ`--model_args`æ¨¡å‹å‚æ•°ï¼Œ`--tasks`æµ‹è¯„ä»»åŠ¡ï¼Œ`--output_path`è¾“å‡ºè·¯å¾„ï¼Œ`--num_fewshot`ã€‚
```bash
cd evaluate
bash eval_clm.sh
```

å¯åŠ¨æ¨ç†ã€‚
```bash
cd inference
bash inference.sh
```

å¯åŠ¨ç”Ÿæˆã€‚éœ€è¦ä¿®æ”¹`generate.py`æ–‡ä»¶ï¼Œç¡®å®šç”Ÿæˆæ•°æ®é•¿åº¦å’Œæ¨¡å‹åŠ è½½æ–¹å¼ï¼Œéœ€è¦é¢„å¤„ç†ç”Ÿæˆæ–‡æœ¬ã€‚
```bash
cd inference
bash generate.sh
```

å¯åŠ¨æ•°æ®é¢„å¤„ç†ã€‚ç”±äºéœ€è¦ç”¨åˆ°tokenizerï¼Œæ‰€ä»¥éœ€è¦`export PYTHONPATH="/path/to/bbt-neutron:${PYTHONPATH}"`å£°æ˜é¡¹ç›®è·¯å¾„
```bash
cd data
export PYTHONPATH="/path/to/bbt-neutron:${PYTHONPATH}"
python3 data_utils.py
```
